<!--
// Licensed to the Apache Software Foundation (ASF) under one
// or more contributor license agreements.  See the NOTICE file
// distributed with this work for additional information
// regarding copyright ownership.  The ASF licenses this file
// to you under the Apache License, Version 2.0 (the
// "License"); you may not use this file except in compliance
// with the License.  You may obtain a copy current the License at
//
//    http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing,
// software distributed under the License is distributed on an
// "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
// KIND, either express or implied.  See the License for the
// specific language governing permissions and limitations
// under the License.
// -->
<configuration>
    <!-- Context is evaluated first. -->
    <context>
        <context-entry name="stage">${properties:system:STAGE?default=DEV}</context-entry>
        <context-entry name="configdir">${properties:system:configdir?default=.}</context-entry>
        <context-entry name="app">${properties:system.APP?default=NONE}</context-entry>
        <context-entry name="context">${java:org.apache.tamaya.context.Context#id()}</context-entry>
        <context-entry name="company">Trivadis</context-entry>
        <context-entry name="default-formats">yaml,json</context-entry>
        <context-entry name="default-refresh-period">5 SECOND</context-entry>
    </context>
    <context name="APP">
        <context-entry name="application">someAppName</context-entry>
    </context>

    <!-- combinationPolicy type="" / -->

    <!-- Configuration definition. -->

    <property-sources>
       <source enabled="${stage=TEST || stage=PTA || stage=PROD}"
           type="env-properties">
           <filter type="PropertyMapping">
               <param name="mapTarget">ENV.</param>
           </filter>
           <filter type="AccessMask">
               <param name="roles">admin,power-user</param>
               <param name="policy">mask</param>
               <param name="mask">*****</param>
               <param name="matchExpression">SEC_</param>
           </filter>
       </source>
       <source type="sys-properties" >
           <filter type="ImmutablePropertySource" />
       </source>
       <source type="file" refreshable="true">
           <name>config.json</name>
           <param name="location">config.json</param>
       </source>
        <source type="file" refreshable="true">
            <name>config.xml</name>
            <param name="location">config.xml</param>
            <param name="formats">xml-properties</param>
        </source>
       <source-provider type="resource">
           <name>classpath:application-config.yml</name>
           <param name="location">/META-INF/application-config.yml</param>
       </source-provider>
       <source type="ch.mypack.MyClassSource" />
       <!--<include enabled="${stage==TEST}">TEST-config.xml</include>-->
       <source-provider type="resource" enabled="${configdir != null}">
           <name>config-dir</name>
           <param name="location">/${configdir}/**/*.json</param>
       </source-provider>
       <source type="url" refreshable="true">
           <name>remote</name>
           <param name="location">https://www.confdrive.com/cfg/customerId=1234</param>
           <param name="formats">json</param>
           <filter type="CachedPropertySource">
               <param name="ttl">30 SECOND</param>
           </filter>
       </source>
    </property-sources>
    <property-filters>
        <filter type="UsageTrackerFilter"/>
        <filter type="AccessControl">
            <param name="roles">admin,power-user</param>
            <param name="policy">hide</param>
            <param name="expression">*.secret</param>
        </filter>
        <filter type="Cache">
            <param name="ttl">30000</param>
            <param name="expression">cached.*</param>
        </filter>
    </property-filters>
    <property-converters>
    <!--<converter type="AllInOneConverter"/>-->
        <default-converters/>
    </property-converters>

</configuration>

